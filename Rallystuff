import com.rallydev.rest.RallyRestApi;
import com.rallydev.rest.request.CreateRequest;
import com.rallydev.rest.request.QueryRequest;
import com.rallydev.rest.response.CreateResponse;
import com.rallydev.rest.response.QueryResponse;
import com.rallydev.rest.util.Fetch;
import com.rallydev.rest.util.QueryFilter;
import com.google.gson.JsonObject;
import com.google.gson.JsonArray;
import com.google.gson.JsonElement;

import java.net.URI;

public class RallyCreateTestCase {

    public static void main(String[] args) throws Exception {
        String rallyURL = "https://rally1.rallydev.com";
        String apiKey = "_your_api_key";  // replace with your API Key
        String projectRef = "/project/12345678910";  // replace with your project reference

        RallyRestApi restApi = new RallyRestApi(new URI(rallyURL), apiKey);
        restApi.setApplicationName("CreateTestCaseApp");

        try {
            // Create a new test case
            JsonObject newTestCase = new JsonObject();
            newTestCase.addProperty("Name", "Sample Test Case");
            newTestCase.addProperty("Project", projectRef);
            newTestCase.addProperty("Method", "Manual");
            newTestCase.addProperty("Priority", "High");
            newTestCase.addProperty("Objective", "Verify the functionality of X");

            CreateRequest createRequest = new CreateRequest("testcase", newTestCase);
            CreateResponse createResponse = restApi.create(createRequest);

            if (createResponse.wasSuccessful()) {
                System.out.println("Successfully created test case: " + createResponse.getObject().get("_ref").getAsString());
            } else {
                String[] createErrors = createResponse.getErrors();
                System.out.println("Error occurred creating test case: ");
                for (String error : createErrors) {
                    System.out.println(error);
                }
            }
        } finally {
            // Release resources
            restApi.close();
        }
    }
}
